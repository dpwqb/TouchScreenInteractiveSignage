<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>触屏展示台子页面</title>
	<script src="./js/tailwindcss.js"></script>
	<!-- 引入自定义字体 -->
	<style>
		@font-face {
			font-family: 'SHBreeHeadlineGlobal';
			src: url('./Fonts/sh-bree-headlineglobal-regular.ttf') format('truetype');
		}
	</style>
	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						primary: '#4a6fa5',
						secondary: '#e67e22',
					}
				}
			}
		}
	</script>
	<style type="text/tailwindcss">
		@layer utilities {
      .page-container {
        position: relative;
        width: 100%;
        height: 100vh;
        overflow: hidden;
        touch-action: none; /* 防止浏览器默认滚动干扰 */
      }
      .bg-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        z-index: -1;
      }
      .nav-button {
        position: absolute;
        width: clamp(128px, 16vw, 512px);
        height: clamp(64px, 8vw, 200px);
        top: 20px;
        z-index: 10;
        cursor: pointer;
        opacity: 0.8;
        transition: opacity 0.3s;
      }
      .nav-button:hover {
        opacity: 1;
      }
      .back-button {
        left: 20px;
      }
      .logo {
        right: 20px;
      }
      .page-button {
        position: absolute;
        width: clamp(32px, 6vw, 150px);
        height: clamp(32px, 6vw, 150px);
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
        cursor: pointer;
        opacity: 0.8;
        transition: opacity 0.3s;
      }
      .page-button:hover {
        opacity: 1;
      }
      .left-button {
        left: 20px;
      }
      .right-button {
        right: 20px;
      }
      .content-container {
        position: absolute;
        top: 100px;
        left: 0;
        /* width: 100%; */
		min-width: 100dvw;
		max-width: 100dvw;
        bottom: 40px;
        overflow: hidden;
        touch-action: pan-y;
      }
      .content-wrapper {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        display: flex;
        transition: transform 0.5s ease;
      }
      .svg-container {
		min-width: 100dvw;
		max-width: 100dvw;
        flex: 0 0 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        /* padding: 40px; */
        box-sizing: border-box;
        overflow: hidden; /* 防止内容溢出 */
        position: relative; /* 为内部绝对定位提供参考 */
      }
      .content-inner-wrapper {
        width: 100%;
        height: 100%;
        padding: 20px;
        box-sizing: border-box;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
      }
      .page-title {
        font-family: 'SHBreeHeadlineGlobal', sans-serif;
        font-size: clamp(2rem, 4vw, 5rem); /* 响应式字体大小 */
        font-weight: bold;
        color: #EC6600;
		padding: 50px 32px 0 32px;
        width: 100%;
        max-width: 100%;
        /* text-align: center; */
        word-wrap: break-word; /* 长文本自动换行 */
        overflow-wrap: break-word;
        margin-bottom: 10px;
        box-sizing: border-box;
      }
      .page-subtitle {
        font-size: clamp(1.2rem, 2.5vw, 3rem); /* 响应式字体大小 */
        color: white;
        width: 100%;
        max-width: 100%;
		padding: 0 32px;
        word-wrap: break-word; /* 长文本自动换行 */
        overflow-wrap: break-word;
        margin-bottom: 50px;
        box-sizing: border-box;
      }
      .svg-wrapper {
        width: auto;
		margin: 10px;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        box-sizing: border-box;
      }
      .svg-content {
        width: 90%;
        height: auto;
        max-width: 100%;
        object-fit: contain;
        pointer-events: none; /* 关键：触摸事件穿透SVG */
        box-sizing: border-box;
      }
      .page-indicator {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 10;
      }
      .indicator-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.5);
        transition: background-color 0.3s;
      }
      .indicator-dot.active {
        background-color: white;
      }
      
      /* 响应式媒体查询 */
      @media (max-width: 768px) {
        .content-inner-wrapper {
          padding: 15px;
        }
        .page-title {
          font-size: clamp(1.5rem, 3vw, 3rem);
        }
        .page-subtitle {
          font-size: clamp(1rem, 2vw, 2rem);
        }
      }
      
      @media (max-width: 480px) {
        .content-container {
          padding: 10px;
        }
        .svg-container {
          padding: 10px;
        }
        .content-inner-wrapper {
          padding: 10px;
        }
        .page-title {
          font-size: clamp(1.2rem, 2.5vw, 2.5rem);
        }
        .page-subtitle {
          font-size: clamp(0.9rem, 1.8vw, 1.8rem);
        }
      }
    }
  </style>
</head>

<body class="bg-black">
	<div class="page-container">
		<!-- 背景图片 -->
		<div class="bg-image" style="background-image: url('./img/bg/bg.jpg')"></div>

		<!-- 返回按钮 -->
		<div class="nav-button back-button" onclick="getReturnUrl()">
			<img src="./img/back.svg" alt="返回首页" class="w-full h-full object-contain">
		</div>

		<!-- Logo -->
		<div class="nav-button logo">
			<img src="./img/logo.svg" alt="Logo" class="w-full h-full object-contain">
		</div>

		<!-- 左翻页按钮 -->
		<div class="page-button left-button" id="leftButton">
			<img src="./img/left.svg" alt="上一页" class="w-full h-full object-contain">
		</div>

		<!-- 右翻页按钮 -->
		<div class="page-button right-button" id="rightButton">
			<img src="./img/right.svg" alt="下一页" class="w-full h-full object-contain">
		</div>

		<!-- 内容容器 -->
		<div class="content-container">
			<div class="content-wrapper" id="contentWrapper">
				<!-- 内容由JS加载 -->
			</div>
		</div>

		<!-- 页码指示器 -->
		<div class="page-indicator" id="pageIndicator"></div>
	</div>

	<script src="./js/jquery-1.8.3.min.js"></script>
	<script>
		$(document).ready(function () {
			let pageData = [];
			let currentPage = 0;
			let totalPages = 0;
			let pageType = '';

			init();

			function init() {
				const urlParams = new URLSearchParams(window.location.search);
				const pageParam = urlParams.get('page');
				pageType = urlParams.get('type') || ''; // 获取页面参数
				currentPage = pageParam ? parseInt(pageParam) - 1 : 0;
				loadPageData();
			}

			function loadPageData() {
				$.getJSON('./data.json', function (data) {
					// 检查页面类型是否存在
					if (pageType && data.hasOwnProperty(pageType)) {
						pageData = data[pageType];
						totalPages = pageData.length;
						if (currentPage < 0) currentPage = 0;
						if (currentPage >= totalPages) currentPage = totalPages - 1;
						renderPageContent();
						renderPageIndicator();
						bindEvents();
						updatePageButtons(); // 初始化时更新按钮显示状态
					} else {
						// 如果页面类型不存在，弹出提示并返回到首页
						alert('访问的页面不存在！');
						window.location.href = './index.html';
					}
				}).fail(() => {
					console.error('加载页面数据失败');
					alert('加载页面数据失败！');
					window.location.href = './index.html';
				});
			}

			function renderPageContent() {
				const contentWrapper = $('#contentWrapper');
				contentWrapper.empty();
				pageData.forEach((page) => {
					const svgContainer = $('<div class="svg-container"></div>');
					
					// 创建内容内部包装器
					const contentInnerWrapper = $('<div class="content-inner-wrapper"></div>');
					
					// 添加标题元素
					if (page.title) {
						const titleElement = $('<div class="page-title"></div>');
						titleElement.html(page.title);
						contentInnerWrapper.append(titleElement);
					}
					
					// 添加副标题元素
					if (page.subtitle) {
						const subtitleElement = $('<div class="page-subtitle"></div>');
						subtitleElement.html(page.subtitle);
						contentInnerWrapper.append(subtitleElement);
					}
					
					// 创建SVG包装器
					const svgWrapper = $('<div class="svg-wrapper"></div>');
					const svgContent = $('<object class="svg-content" type="image/svg+xml"></object>');
					svgContent.attr('data', page.URL);
					svgWrapper.append(svgContent);
					contentInnerWrapper.append(svgWrapper);
					
					// 将内容内部包装器添加到容器中
					svgContainer.append(contentInnerWrapper);
					contentWrapper.append(svgContainer);
				});
				updateContentPosition();
			}

			function renderPageIndicator() {
				const pageIndicator = $('#pageIndicator');
				pageIndicator.empty();
				for (let i = 0; i < totalPages; i++) {
					const dot = $('<div class="indicator-dot"></div>');
					if (i === currentPage) dot.addClass('active');
					pageIndicator.append(dot);
				}
			}

			function bindEvents() {
				$('#leftButton').on('click', () => goToPage(currentPage - 1));
				$('#rightButton').on('click', () => goToPage(currentPage + 1));

				const touchArea = document.querySelector('.page-container');
				let startX = 0, endX = 0;
				const threshold = 50;

				touchArea.addEventListener('touchstart', e => {
					if (e.touches.length > 0) startX = e.touches[0].clientX;
					endX = startX;
				}, { passive: true });

				touchArea.addEventListener('touchmove', e => {
					if (e.touches.length > 0) endX = e.touches[0].clientX;
					e.preventDefault();
				}, { passive: false });

				touchArea.addEventListener('touchend', () => {
					const diffX = startX - endX;
					if (Math.abs(diffX) > threshold) {
						if (diffX > 0) goToPage(currentPage + 1);
						else goToPage(currentPage - 1);
					}
				});

				$(window).on('resize', updateContentPosition);
			}

			function goToPage(pageIndex) {
				if (pageIndex < 0 || pageIndex >= totalPages) return;
				currentPage = pageIndex;
				const url = new URL(window.location.href);
				url.searchParams.set('page', currentPage + 1);
				url.searchParams.set('type', pageType); // 保持页面类型参数
				window.history.pushState({}, '', url);
				updateContentPosition();
				updatePageIndicator();
				updatePageButtons(); // 翻页后更新按钮状态
			}

			function updateContentPosition() {
				const containerWidth = $('.content-container').width();
				$('#contentWrapper').css('transform', `translateX(${-currentPage * containerWidth}px)`);
			}

			function updatePageIndicator() {
				$('.indicator-dot').removeClass('active').eq(currentPage).addClass('active');
			}

			// 根据页码控制翻页按钮显示/隐藏
			function updatePageButtons() {
				const leftBtn = $('#leftButton');
				const rightBtn = $('#rightButton');

				if (totalPages <= 1) {
					leftBtn.hide();
					rightBtn.hide();
				} else {
					if (currentPage === 0) {
						leftBtn.fadeOut(200);
						rightBtn.fadeIn(200);
					} else if (currentPage === totalPages - 1) {
						rightBtn.fadeOut(200);
						leftBtn.fadeIn(200);
					} else {
						leftBtn.fadeIn(200);
						rightBtn.fadeIn(200);
					}
				}
			}
		});

		// 获取返回URL的函数
		function getReturnUrl() {
			const urlParams = new URLSearchParams(window.location.search);
			const returnPage = urlParams.get('returnPage');
			if (returnPage) {
				window.location.href = `./index.html?page=${returnPage}`;
			} else {
				window.location.href = './index.html?page=0';
			}
		}
	</script>

</body>

</html>