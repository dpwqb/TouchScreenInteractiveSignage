<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<title>触屏展示台子页面</title>
	<script src="./js/tailwindcss.js"></script>
	<script>
		tailwind.config = {
			theme: {
				extend: {
					colors: {
						primary: '#4a6fa5',
						secondary: '#e67e22',
					}
				}
			}
		}
	</script>
	<style type="text/tailwindcss">
		@layer utilities {
      .page-container {
        position: relative;
        width: 100%;
        height: 100vh;
        overflow: hidden;
        touch-action: none; /* 防止浏览器默认滚动干扰 */
      }
      .bg-image {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        z-index: -1;
      }
      .nav-button {
        position: absolute;
        width: clamp(64px, 32vw, 128px);
        height: clamp(64px, 32vw, 128px);
        /* top: 10px; */
        z-index: 10;
        cursor: pointer;
        opacity: 0.8;
        transition: opacity 0.3s;
      }
      .nav-button:hover {
        opacity: 1;
      }
      .back-button {
        left: 20px;
      }
      .logo {
        right: 20px;
      }
      .page-button {
        position: absolute;
        width: clamp(32px, 4vw, 64px);
        height: clamp(32px, 4vw, 64px);
        top: 50%;
        transform: translateY(-50%);
        z-index: 10;
        cursor: pointer;
        opacity: 0.8;
        transition: opacity 0.3s;
      }
      .page-button:hover {
        opacity: 1;
      }
      .left-button {
        left: 20px;
      }
      .right-button {
        right: 20px;
      }
      .content-container {
        position: absolute;
        top: 100px;
        left: 0;
        width: 100%;
        bottom: 40px;
        overflow: hidden;
        touch-action: pan-y;
      }
      .content-wrapper {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        display: flex;
        transition: transform 0.5s ease;
      }
      .svg-container {
        flex: 0 0 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 0 20px;
        box-sizing: border-box;
      }
      .svg-content {
        width: 100%;
        height: 100%;
        object-fit: contain;
        pointer-events: none; /* 关键：触摸事件穿透SVG */
      }
      .page-indicator {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        gap: 10px;
        z-index: 10;
      }
      .indicator-dot {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.5);
        transition: background-color 0.3s;
      }
      .indicator-dot.active {
        background-color: white;
      }
    }
  </style>
</head>

<body class="bg-gray-100">
	<div class="page-container">
		<!-- 背景图片 -->
		<div class="bg-image" style="background-image: url('./img/bg.jpg')"></div>

		<!-- 返回按钮 -->
		<div class="nav-button back-button" onclick="window.location.href='./home.html'">
			<img src="./img/back.svg" alt="返回首页" class="w-full h-full object-contain">
		</div>

		<!-- Logo -->
		<div class="nav-button logo">
			<img src="./img/logo.svg" alt="Logo" class="w-full h-full object-contain">
		</div>

		<!-- 左翻页按钮 -->
		<div class="page-button left-button" id="leftButton">
			<img src="./img/left.svg" alt="上一页" class="w-full h-full object-contain">
		</div>

		<!-- 右翻页按钮 -->
		<div class="page-button right-button" id="rightButton">
			<img src="./img/right.svg" alt="下一页" class="w-full h-full object-contain">
		</div>

		<!-- 内容容器 -->
		<div class="content-container">
			<div class="content-wrapper" id="contentWrapper">
				<!-- SVG内容由JS加载 -->
			</div>
		</div>

		<!-- 页码指示器 -->
		<div class="page-indicator" id="pageIndicator"></div>
	</div>

	<script src="./js/jquery-1.8.3.min.js"></script>
	<script>
		$(document).ready(function () {
			let pageData = [];
			let currentPage = 0;
			let totalPages = 0;

			init();

			function init() {
				const urlParams = new URLSearchParams(window.location.search);
				const pageParam = urlParams.get('page');
				currentPage = pageParam ? parseInt(pageParam) - 1 : 0;
				loadPageData();
			}

			function loadPageData() {
				$.getJSON('./data.json', function (data) {
					pageData = data.page;
					totalPages = pageData.length;
					if (currentPage < 0) currentPage = 0;
					if (currentPage >= totalPages) currentPage = totalPages - 1;
					renderPageContent();
					renderPageIndicator();
					bindEvents();
					updatePageButtons(); // ✅ 初始化时更新按钮显示状态
				}).fail(() => console.error('加载页面数据失败'));
			}

			function renderPageContent() {
				const contentWrapper = $('#contentWrapper');
				contentWrapper.empty();
				pageData.forEach((page) => {
					const svgContainer = $('<div class="svg-container"></div>');
					const svgContent = $('<object class="svg-content" type="image/svg+xml"></object>');
					svgContent.attr('data', page.URL);
					svgContainer.append(svgContent);
					contentWrapper.append(svgContainer);
				});
				updateContentPosition();
			}

			function renderPageIndicator() {
				const pageIndicator = $('#pageIndicator');
				pageIndicator.empty();
				for (let i = 0; i < totalPages; i++) {
					const dot = $('<div class="indicator-dot"></div>');
					if (i === currentPage) dot.addClass('active');
					pageIndicator.append(dot);
				}
			}

			function bindEvents() {
				$('#leftButton').on('click', () => goToPage(currentPage - 1));
				$('#rightButton').on('click', () => goToPage(currentPage + 1));

				const touchArea = document.querySelector('.page-container');
				let startX = 0, endX = 0;
				const threshold = 50;

				touchArea.addEventListener('touchstart', e => {
					if (e.touches.length > 0) startX = e.touches[0].clientX;
					endX = startX;
				}, { passive: true });

				touchArea.addEventListener('touchmove', e => {
					if (e.touches.length > 0) endX = e.touches[0].clientX;
					e.preventDefault();
				}, { passive: false });

				touchArea.addEventListener('touchend', () => {
					const diffX = startX - endX;
					if (Math.abs(diffX) > threshold) {
						if (diffX > 0) goToPage(currentPage + 1);
						else goToPage(currentPage - 1);
					}
				});

				$(window).on('resize', updateContentPosition);
			}

			function goToPage(pageIndex) {
				if (pageIndex < 0 || pageIndex >= totalPages) return;
				currentPage = pageIndex;
				const url = new URL(window.location.href);
				url.searchParams.set('page', currentPage + 1);
				window.history.pushState({}, '', url);
				updateContentPosition();
				updatePageIndicator();
				updatePageButtons(); // ✅ 翻页后更新按钮状态
			}

			function updateContentPosition() {
				const containerWidth = $('.content-container').width();
				$('#contentWrapper').css('transform', `translateX(${-currentPage * containerWidth}px)`);
			}

			function updatePageIndicator() {
				$('.indicator-dot').removeClass('active').eq(currentPage).addClass('active');
			}

			// ✅ 新增：根据页码控制翻页按钮显示/隐藏
			function updatePageButtons() {
				const leftBtn = $('#leftButton');
				const rightBtn = $('#rightButton');

				if (totalPages <= 1) {
					leftBtn.hide();
					rightBtn.hide();
				} else {
					if (currentPage === 0) {
						leftBtn.fadeOut(200);
						rightBtn.fadeIn(200);
					} else if (currentPage === totalPages - 1) {
						rightBtn.fadeOut(200);
						leftBtn.fadeIn(200);
					} else {
						leftBtn.fadeIn(200);
						rightBtn.fadeIn(200);
					}
				}
			}
		});
	</script>

</body>

</html>